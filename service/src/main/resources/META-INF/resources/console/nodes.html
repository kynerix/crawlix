<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/dataTables.jqueryui.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/css/patternfly-additions.min.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.18/js/dataTables.jqueryui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/patternfly/3.24.0/js/patternfly.min.js"></script>

    <script src="js/console-common.js"></script>
</head>

<body>
    <nav class="navbar navbar-default navbar-pf" role="navigation">
        <div class="collapse navbar-collapse navbar-collapse-1">
            <ul class="nav navbar-nav navbar-primary">
                <li class="active">
                    <a href="nodes.html">Crawler nodes</a>
                </li>
                <li>
                    <a href="workspaces.html">Workspaces</a>
                </li>
                <li>
                    <a href="jobs.html">Jobs</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container-fluid">
        <br>
        <!-- Toolbar -->
        <div class="row table-view-pf-toolbar" id="toolbar">
            <div class="col-sm-12">
                <form class="toolbar-pf-actions">
                    <div class="form-group">
                        <button class="btn btn-lg btn-default" type="button" id="refreshbutton"
                            onclick="refreshTable()"><i class="fa fa-refresh"></i> Refresh
                        </button>
                    </div>
                </form>
            </div>
        </div>
        <div class="alert alert-success" style="display:none" id="successMsg">
            <span class="pficon pficon-ok"></span>
            <strong>All good!</strong> Operation has been successful</a>.
        </div>
        <div class="alert alert-danger" style="display:none" id="errorMsg">
            <span class="pficon pficon-error-circle-o"></span>
            <strong>Error</strong>: <span id="errorTxt"></span></a>
        </div>
        <table class="table table-striped table-hover" id="table1">
            <thead>
                <tr>
                    <th>Key</th>
                    <th>Status</th>
                    <th>Message</th>
                    <th>Endpoint</th>
                    <th>Last start</th>
                    <th>Actions</th>
                </tr>
            </thead>
        </table>
    </div>
    <!------------------------------------------------------------------------------------------------------------------------------------------------>
    <script>

        function refreshTable() {
            sendRequest("GET", "/admin/list-nodes", function (data) {
                setDataSet(data);

                // DataTable Config
                $("#table1").DataTable({
                    columns: [
                        { data: "key" },
                        { data: "status" },
                        { data: "message", "defaultContent": "-" },
                        { data: "publicURI" },
                        {
                            render:
                                function (data, type, rowData, meta) {
                                    return renderDate(rowData.lastStartTime);
                                }
                        },
                        {
                            data: null,
                            className: "table-view-pf-actions",
                            render: function (data, type, full, meta) {
                                // Inline action kebab renderer
                                return '<div class="dropdown dropdown-kebab-pf">' +
                                    '<button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">' +
                                    '<span class="fa fa-ellipsis-v"></span></button>' +
                                    '<ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownKebabRight">' +
                                    '<li><a href="#" onClick="startNode(\'' + data.key + '\')">Start</a></li>' +
                                    '<li><a href="#" onClick="stopNode(\'' + data.key + '\')">Stop</a></li>'
                            }
                        }
                    ],
                    data: getDataSet(),
                    order: [[0, 'desc']]
                });
            });

        }

        $(document).ready(function () {
            refreshTable();
        });
    </script>
</body>

</html>